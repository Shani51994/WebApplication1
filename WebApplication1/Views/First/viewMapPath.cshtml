
@{
    ViewBag.Title = "viewMapPath";
}

<!DOCTYPE html>
<html>
<head>
    <style>
        html
        body {
            width: 100%;
            height: 100%;
            margin: 0;
        }

        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>

    <script>

        var IntervalTime = @Session["time"] * 1000
        var htmlCanvas = document.getElementById("canvas");
        var context = htmlCanvas.getContext("2d");

        (function () {
            var image = new Image();

            initialize();

            function initialize() {
                window.addEventListener('resize', resizeCanvas, false);
                resizeCanvas();
            }

            function resizeCanvas() {
                htmlCanvas.width = window.innerWidth;
                htmlCanvas.height = window.innerHeight;
                image.onload = function () {
                    context.drawImage(image, 0, 0, window.innerWidth, window.innerHeight);
                    circle(@ViewBag.lon, @ViewBag.lat, context);
                    
                }
                image.src = "/export-map-share.png";
            }
        })();

        oldLon = @ViewBag.lon;
        oldLat =  @ViewBag.lat;

        //allCircle = [];
        myTimer = (function () {
            $.post("@Url.Action("createXmlData")").done(function (xml) {
                var xmlDoc = $.parseXML(xml);
                $xml = $(xmlDoc);
                Lon = parseFloat($xml.find("Lon").text());
                Lat = parseFloat($xml.find("Lat").text());
                //var locationPair = { x: Lon, y: Lat };
                //allCircle.push(locationPair);
                circle(Lon, Lat, context);
                //drawPath(@ViewBag.lon, @ViewBag.lat , allCircle, context);

                context.moveTo(oldLon, oldLat);
                context.lineTo(Lon, Lat);
                //context.strokeStyle = 'red';
                context.stroke();
                oldLon = Lon;
                oldLat = Lat;
                
                //context.beginPath();               
            });
         });

        setInterval(myTimer, IntervalTime);
        myTimer();

    </script>

</body>
</html>
